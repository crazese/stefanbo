include:
  - php_init

php-pear:
	pkg.installed

apc:
	pecl.installed:
	  - require:
	  	- pkg: php-pear

memcache:
	pecl.installed:
		- require:
			- pkg: php-pear

memcached:
	pkg.installed
	
memcached_start:
	cmd:
		- name: /usr/bin/memcached -m 64 -p 11211 -u nobody -l 127.0.0.1
		- wait
		- require:
			- pkg: memcached

/etc/php5/fpm/php.ini:
  file.managed
    - source: salt://prod/authserver/php.ini
    - require:
      - pkg: php5-fpm

php5-fpm_restart:
  cmd:
    - name: /etc/init.d/php5-fpm restart
    - wait
    - watch:
      file: /etc/php5/fpm/php.ini

/var/www/authserver:
  file.directory:
    - user: root
    - group: root
    - file_mode: 744
    - dir_mode: 755
    - makedirs: True
    - recurse: 
      - user
      - group
      - mode
  file.recurse:
    - source: salt://prod/authserver/authServer
    - include_empty: True
